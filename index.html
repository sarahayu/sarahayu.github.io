<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" href="reset.css" />
	<link rel="stylesheet" href="style.css" />
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,300;0,700;1,300&family=Roboto:wght@300;400&family=Tangerine:wght@700&display=swap"
		rel="stylesheet">
	<title>Sarah Yuniar's Portfolio</title>
</head>

<body>
	<svg id="sky"></svg>
	<h1 class="name"><span>Sarah</span><span>Yuniar</span></h1>
	<script type="module">
		import * as d3 from 'https://cdn.jsdelivr.net/npm/d3@7/+esm'
		import { STAR_DATA } from './assets/data.js'
		
		const degToRad = deg => deg * 3.1415 / 180
		
		const margin = { top: 20, right: 20, bottom: 20, left: 20 },
			width = Math.min(window.innerWidth, window.innerHeight * 3.5 / 2),
			height = window.innerHeight;
		
		const svg = d3.select('#sky')
			.attr('width', width)
			.attr('height', height)
		
		const x = d3.scaleLinear()
			.domain([d3.min(STAR_DATA, d => d3.min(d.stars, dd => dd.x)), d3.max(STAR_DATA, d => d3.max(d.stars, dd => dd.x))])
			.range([margin.left, width - margin.right]);
		
		const y = d3.scaleLinear()
			.domain([d3.min(STAR_DATA, d => d3.min(d.stars, dd => dd.y)), d3.max(STAR_DATA, d => d3.max(d.stars, dd => dd.y))])
			.range([height - margin.top, margin.bottom]);
		
		const r = d3.scaleLinear()
			.domain([1, d3.max(STAR_DATA, d => d3.max(d.stars, dd => dd.mag))])
			.range([6, 1])
			.clamp(true);
		
		const op = d3.scaleLinear()
			.domain([1, d3.max(STAR_DATA, d => d3.max(d.stars, dd => dd.mag))])
			.range([1, 0.3])
			.clamp(true);
		
		
		svg.on('click', (ev) => {
			console.log(`${x.invert(ev.offsetX)},${y.invert(ev.offsetY)}`)
		})
		
		let north = [-0.0010782980749916567, 0.09320250541074836]
		
		let grid = svg
			.append('g')
			.attr('class', 'star-grid')
			.style('transform', `translate(${x(north[0])}px,${y(north[1])}px) rotate(15deg)`)
		
		grid
			.selectAll('rads')
			.data(d3.ticks(0, 1440, 5).slice(1))
			.enter()
			.append('circle')
			.attr('r', r => r)
		
		grid
			.selectAll('as')
			.data(d3.range(0, 360, 30))
			.enter()
			.append('line')
			.attr('transform', function (d) { return `rotate(${-d})` })
			.attr('x2', 1024)
		
		svg.append('g')
			.selectAll('constLines')
			.data(STAR_DATA)
			.join('g')
			.each(function (d) {
				let constElem = d3.select(this)
				let constBB = constElem.append('g')
					.attr('tabindex', d => (d.const == 'nan' || d.const == 'Cas' ? -1 : 0))
					.attr('class', d => d.const == 'nan' || d.const == 'Cas' ? '' : ' const-group-bb ')
					.style('pointer-events', d => d.const == 'nan' || d.const == 'Cas' ? 'none' :  'bounding-box')
					.on('mouseenter focus', (_, d) => {
						if (d.const == 'nan' || d.const == 'Cas') return
						d.lettersElem
							.attr('class', d.const + ' star-let hovered')
							.transition()
							.duration(250)
							.ease(d3.easeCubicOut)
							.attr('x', function (dd, i) { return x(d.center[0]) + (i - d.letters.length / 2) * 25; })
							.attr('y', function (dd, i) { return y(d.center[1]); })
						d.labelElem
							.style('display', 'none')
						d.starsElem
							.transition()
							.duration(250)
							.ease(d3.easeCubicOut)
							.attr('cx', function (d) { return x(d.newX); })
							.attr('cy', function (d) { return y(d.newY); })
							.attr('opacity', 0.17)
					})
					.on('mouseleave blur', (_, d) => {
						if (d.const == 'nan' || d.const == 'Cas') return
						d.lettersElem
							.attr('class', d.const + ' star-let')
							.transition()
							.duration(250)
							.ease(d3.easeCubicOut)
							.attr('x', function (d) { return x(d.pos[0]) + 20 * Math.sin(degToRad(d.offset)); })
							.attr('y', function (d) { return y(d.pos[1]) - 20 * Math.cos(degToRad(d.offset)) + 3; })
						d.labelElem
							.style('display', 'initial')
						d.starsElem
							.transition()
							.duration(250)
							.ease(d3.easeCubicOut)
							.attr('cx', function (d) { return x(d.x); })
							.attr('cy', function (d) { return y(d.y); })
							.attr('r', function (d) { return r(d.mag); })
							.attr('opacity', function (d) { return op(d.mag); })
					})
					.on('click keypress', (e, d) => {
						console.log(e)
						if (e.type == 'click' || (e.type == 'keypress' && e.key == 'Enter')) {
							if (d.const == 'Dra')
								window.location.href = './gallery.html'
							else if (d.const == 'Cyg')
								window.location.href = './about.html'
						}
					})
				
				if (d.lines)
					for (let i = 0; i < d.lines.length; i += 4)
						constBB
							.append('path')
							.attr('d', d3.line()
								.x(d => x(d[0]))
								.y(d => y(d[1]))([[d.lines[i + 0], d.lines[i + 1]], [d.lines[i + 2], d.lines[i + 3]]]))
							.attr('stroke', 'rgba(255, 255, 255, 0.2)')
							.style('pointer-events', 'none')
				
				let starsElem = constElem
					.selectAll('dots')
					.data(d.stars)
					.join('circle')
					.attr('cx', function (d) { return x(d.x); })
					.attr('cy', function (d) { return y(d.y); })
					.attr('r', function (d) { return r(d.mag); })
					.attr('opacity', function (d) { return op(d.mag); })
					.style('fill', '#ffebd8')
					.style('pointer-events', 'none')
		
				let lettersElem = d.letters && constElem
					.selectAll('lets')
					.data(d.letters)
					.join('text')
					.attr('class', d.const + ' star-let')
					.attr('dominant-baseline', 'middle')
					.attr('text-anchor', 'middle')
					.attr('x', function (d) { return x(d.pos[0]) + 20 * Math.sin(degToRad(d.offset)); })
					.attr('y', function (d) { return y(d.pos[1]) - 20 * Math.cos(degToRad(d.offset)) + 3; })
					.text(function (d) { return d.let; })
					.style('fill', '#ffffff')
					.style('pointer-events', 'none')
		
				let labelElem = d.fullconst && constElem
					.append('text')
					.text(d.fullconst)
					.attr('class', 'const-label')
					.attr('dominant-baseline', 'middle')
					.attr('text-anchor', 'middle')
					.style('transform', `translate(${x(d.label_center[0])}px,${y(d.label_center[1])}px) rotate(${d.label_rot}deg)`)
					.style('pointer-events', 'none')
					
				if (d.const != 'nan' && d.const != 'Cas') {
					d.starsElem = starsElem
					d.lettersElem = lettersElem
					d.labelElem = labelElem
				}
			})

	</script>
</body>

</html>